<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HireAI — ERD v2 (6 Tables)</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }

    body {
      font-family: 'JetBrains Mono', 'Courier New', monospace;
      background: #06080f;
      color: #e2e8f0;
      overflow: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.025) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.025) 1px, transparent 1px);
      background-size: 32px 32px;
      pointer-events: none;
    }

    /* ── TOOLBAR ── */
    .toolbar {
      position: fixed; top: 0; left: 0; right: 0; height: 50px;
      background: #0b0e1a; border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 20px; z-index: 100;
    }
    .tb-left { display: flex; align-items: center; gap: 12px; }
    .tb-logo { font-size: 0.88rem; font-weight: 800; color: #e2e8f0; letter-spacing: -0.02em; }
    .tb-logo span { color: #4ade80; }
    .tb-sep { width: 1px; height: 20px; background: rgba(255,255,255,0.12); }
    .tb-title { font-size: 0.7rem; font-weight: 500; color: #475569; letter-spacing: 0.08em; text-transform: uppercase; }
    .tb-right { display: flex; align-items: center; gap: 8px; }
    .btn {
      padding: 6px 12px; border-radius: 4px;
      border: 1px solid rgba(255,255,255,0.12); background: #0f1220;
      color: #475569; font-family: inherit; font-size: 0.68rem; cursor: pointer;
      display: flex; align-items: center; gap: 5px; transition: all 0.15s;
    }
    .btn:hover { color: #e2e8f0; border-color: rgba(255,255,255,0.2); }
    .zoom-val { font-size: 0.68rem; color: #475569; min-width: 36px; text-align: center; }
    .badge-db { padding: 6px 12px; border-radius: 4px; background: #0f1220; border: 1px solid rgba(255,255,255,0.12); color: rgba(74,222,128,0.8); font-size: 0.68rem; font-family: inherit; }

    /* ── LEGEND ── */
    .legend {
      position: fixed; bottom: 20px; left: 20px; z-index: 100;
      background: #0b0e1a; border: 1px solid rgba(255,255,255,0.12);
      border-radius: 12px; padding: 14px 16px; min-width: 210px;
    }
    .leg-title { font-size: 0.58rem; font-weight: 600; letter-spacing: 0.12em; text-transform: uppercase; color: #475569; margin-bottom: 8px; }
    .leg-row { display: flex; align-items: center; gap: 8px; font-size: 0.62rem; color: #64748b; margin-top: 5px; }
    .leg-dot { width: 10px; height: 10px; border-radius: 2px; flex-shrink: 0; }
    .leg-line { width: 22px; height: 2px; border-radius: 1px; flex-shrink: 0; }
    .leg-sep { border: none; border-top: 1px solid rgba(255,255,255,0.06); margin: 6px 0; }

    /* ── CANVAS ── */
    .wrap { position: fixed; inset: 50px 0 0 0; overflow: hidden; cursor: grab; }
    .wrap:active { cursor: grabbing; }
    .cvs { position: absolute; transform-origin: 0 0; }
    svg.rel { position: absolute; top: 0; left: 0; pointer-events: none; overflow: visible; z-index: 1; }

    /* ── TABLE CARD ── */
    .tbl {
      position: absolute; width: 280px; z-index: 2;
      background: #0f1220; border-radius: 12px; overflow: hidden;
      box-shadow: 0 4px 24px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.06);
      animation: fadeIn 0.4s ease both;
    }
    .tbl:hover { box-shadow: 0 8px 40px rgba(0,0,0,0.7), 0 0 0 1px rgba(255,255,255,0.14); z-index: 10; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px) scale(0.98); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }
    .tbl:nth-child(2) { animation-delay: 0.05s; }
    .tbl:nth-child(3) { animation-delay: 0.10s; }
    .tbl:nth-child(4) { animation-delay: 0.15s; }
    .tbl:nth-child(5) { animation-delay: 0.20s; }
    .tbl:nth-child(6) { animation-delay: 0.25s; }
    .tbl:nth-child(7) { animation-delay: 0.30s; }

    .thead {
      padding: 10px 14px; display: flex; align-items: center; gap: 9px;
      border-bottom: 1px solid rgba(255,255,255,0.08); position: relative;
    }
    .stripe { position: absolute; top: 0; left: 0; right: 0; height: 2px; }
    .ticon {
      width: 26px; height: 26px; border-radius: 4px;
      display: grid; place-items: center; flex-shrink: 0;
    }
    .ticon svg { width: 14px; height: 14px; }
    .tname { font-size: 0.76rem; font-weight: 700; flex: 1; }
    .tbadge { font-size: 0.52rem; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; border-radius: 100px; padding: 2px 7px; }

    .tbody { padding: 5px 0 8px; }
    .cr {
      display: grid; grid-template-columns: 18px 1fr auto;
      gap: 6px; align-items: center; padding: 4px 14px; font-size: 0.66rem;
      transition: background 0.1s;
    }
    .cr:hover { background: rgba(255,255,255,0.025); }
    .ck {
      font-size: 0.56rem; font-weight: 700; width: 14px; height: 14px;
      border-radius: 2px; display: grid; place-items: center;
    }
    .ck.pk { background: rgba(251,191,36,0.15); color: #fbbf24; }
    .ck.fk { background: rgba(148,163,184,0.1); color: #94a3b8; }
    .ck.e  { background: transparent; }
    .cn { font-weight: 500; color: #e2e8f0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .cn.pk { color: #fbbf24; }
    .cn.fk { color: #94a3b8; }
    .ct { font-size: 0.58rem; font-weight: 300; color: #475569; white-space: nowrap; }
    .nn { color: rgba(251,146,60,0.7); font-size: 0.52rem; margin-left: 3px; }
    .sep { height: 1px; background: rgba(255,255,255,0.05); margin: 3px 14px; }
    .csec { padding: 4px 14px 2px; font-size: 0.5rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; color: #334155; }

    /* ── COLOUR GROUPS ── */
    .c-tenant  .stripe { background: #38bdf8; }
    .c-tenant  .ticon  { background: rgba(56,189,248,0.2); color: #38bdf8; }
    .c-tenant  .tname  { color: #38bdf8; }
    .c-tenant  .tbadge { background: rgba(56,189,248,0.1); color: #38bdf8; }

    .c-hiring  .stripe { background: #4ade80; }
    .c-hiring  .ticon  { background: rgba(74,222,128,0.2); color: #4ade80; }
    .c-hiring  .tname  { color: #4ade80; }
    .c-hiring  .tbadge { background: rgba(74,222,128,0.1); color: #4ade80; }

    .c-cand    .stripe { background: #a78bfa; }
    .c-cand    .ticon  { background: rgba(167,139,250,0.2); color: #a78bfa; }
    .c-cand    .tname  { color: #a78bfa; }
    .c-cand    .tbadge { background: rgba(167,139,250,0.1); color: #a78bfa; }

    .c-app     .stripe { background: #f472b6; }
    .c-app     .ticon  { background: rgba(244,114,182,0.2); color: #f472b6; }
    .c-app     .tname  { color: #f472b6; }
    .c-app     .tbadge { background: rgba(244,114,182,0.1); color: #f472b6; }

    .c-intv    .stripe { background: #fb923c; }
    .c-intv    .ticon  { background: rgba(251,146,60,0.2); color: #fb923c; }
    .c-intv    .tname  { color: #fb923c; }
    .c-intv    .tbadge { background: rgba(251,146,60,0.1); color: #fb923c; }

    .c-iq      .stripe { background: #fbbf24; }
    .c-iq      .ticon  { background: rgba(251,191,36,0.15); color: #fbbf24; }
    .c-iq      .tname  { color: #fbbf24; }
    .c-iq      .tbadge { background: rgba(251,191,36,0.1); color: #fbbf24; }

    /* ── TOOLTIP ── */
    .tip {
      position: fixed; background: #141828; border: 1px solid rgba(255,255,255,0.12);
      border-radius: 8px; padding: 8px 12px; font-size: 0.62rem; color: #e2e8f0;
      pointer-events: none; opacity: 0; transition: opacity 0.15s; z-index: 300;
      max-width: 320px; line-height: 1.5;
    }
    .tip.on { opacity: 1; }

    .card-lbl { font-family: 'JetBrains Mono', monospace; font-size: 10px; font-weight: 700; }
  </style>
</head>
<body>

<!-- TOOLBAR -->
<div class="toolbar">
  <div class="tb-left">
    <span class="tb-logo">Hire<span>AI</span></span>
    <div class="tb-sep"></div>
    <span class="tb-title">Database ERD v2 — 6 Tables</span>
  </div>
  <div class="tb-right">
    <button class="btn" onclick="resetView()">Reset</button>
    <button class="btn" onclick="zoom(-0.1)">−</button>
    <span class="zoom-val" id="zv">70%</span>
    <button class="btn" onclick="zoom(0.1)">+</button>
    <div class="tb-sep"></div>
    <span class="badge-db">SQLite</span>
  </div>
</div>

<!-- LEGEND -->
<div class="legend">
  <div class="leg-title">Legend</div>
  <div class="leg-row"><div class="leg-dot" style="background:#38bdf8"></div>Tenant (companies)</div>
  <div class="leg-row"><div class="leg-dot" style="background:#4ade80"></div>Jobs (vacancy)</div>
  <div class="leg-row"><div class="leg-dot" style="background:#a78bfa"></div>Candidates</div>
  <div class="leg-row"><div class="leg-dot" style="background:#f472b6"></div>Applications (+ token)</div>
  <div class="leg-row"><div class="leg-dot" style="background:#fb923c"></div>Interviews (config per job)</div>
  <div class="leg-row"><div class="leg-dot" style="background:#fbbf24"></div>Interview Questions (+ answers)</div>
  <hr class="leg-sep" />
  <div class="leg-row"><div style="font-weight:700;color:#fbbf24;width:22px;text-align:center;font-size:0.58rem">PK</div>Primary Key</div>
  <div class="leg-row"><div style="font-weight:700;color:#94a3b8;width:22px;text-align:center;font-size:0.58rem">FK</div>Foreign Key</div>
  <hr class="leg-sep" />
  <div class="leg-row"><div class="leg-line" style="background:rgba(255,255,255,0.3)"></div>1:N relation</div>
  <div class="leg-row"><div class="leg-line" style="background:#fb923c"></div>1:1 relation</div>
</div>

<!-- TOOLTIP -->
<div class="tip" id="tip"></div>

<!-- CANVAS -->
<div class="wrap" id="wrap">
<div class="cvs" id="cvs">
  <svg class="rel" id="rel" width="2400" height="1800"></svg>

  <!-- ═══════════════════════════
       companies (60, 100)
       ═══════════════════════════ -->
  <div class="tbl c-tenant" id="T-companies" style="left:60px;top:100px">
    <div class="thead">
      <div class="stripe"></div>
      <div class="ticon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/>
        </svg>
      </div>
      <span class="tname">companies</span>
      <span class="tbadge">Tenant Root</span>
    </div>
    <div class="tbody">
      <div class="cr"><div class="ck pk">PK</div><div class="cn pk">id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck e"></div><div class="cn">name</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">email</div><div class="ct">TEXT UNIQUE<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">password_hash</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">plan</div><div class="ct">TEXT DEFAULT 'starter'<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">is_active</div><div class="ct">INT DEFAULT 1<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">created_at</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">updated_at</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
    </div>
  </div>

  <!-- ═══════════════════════════
       jobs (440, 100)
       ═══════════════════════════ -->
  <div class="tbl c-hiring" id="T-jobs" style="left:440px;top:100px">
    <div class="thead">
      <div class="stripe"></div>
      <div class="ticon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/>
        </svg>
      </div>
      <span class="tname">jobs</span>
      <span class="tbadge">Vacancy</span>
    </div>
    <div class="tbody">
      <div class="cr"><div class="ck pk">PK</div><div class="cn pk">id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck fk">FK</div><div class="cn fk">company_id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck e"></div><div class="cn">title</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">department</div><div class="ct">TEXT</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">location</div><div class="ct">TEXT</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">work_type</div><div class="ct">TEXT CHECK(remote|hybrid|onsite)</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">status</div><div class="ct">TEXT DEFAULT 'draft'<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">description</div><div class="ct">TEXT</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">created_at</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">updated_at</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
    </div>
  </div>

  <!-- ═══════════════════════════
       candidates (60, 500)
       ═══════════════════════════ -->
  <div class="tbl c-cand" id="T-candidates" style="left:60px;top:500px">
    <div class="thead">
      <div class="stripe"></div>
      <div class="ticon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
        </svg>
      </div>
      <span class="tname">candidates</span>
      <span class="tbadge">No Account</span>
    </div>
    <div class="tbody">
      <div class="cr"><div class="ck pk">PK</div><div class="cn pk">id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck fk">FK</div><div class="cn fk">company_id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck e"></div><div class="cn">first_name</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">last_name</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">email</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">phone</div><div class="ct">TEXT</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">created_at</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
    </div>
  </div>

  <!-- ═══════════════════════════
       applications (440, 520)
       ═══════════════════════════ -->
  <div class="tbl c-app" id="T-applications" style="left:440px;top:520px">
    <div class="thead">
      <div class="stripe"></div>
      <div class="ticon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/>
        </svg>
      </div>
      <span class="tname">applications</span>
      <span class="tbadge">Candidate x Job</span>
    </div>
    <div class="tbody">
      <div class="cr"><div class="ck pk">PK</div><div class="cn pk">id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck fk">FK</div><div class="cn fk">company_id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck fk">FK</div><div class="cn fk">job_id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck fk">FK</div><div class="cn fk">candidate_id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck fk">FK</div><div class="cn fk">interview_id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck e"></div><div class="cn">status</div><div class="ct">TEXT DEFAULT 'pending'<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">aggregate_score</div><div class="ct">REAL</div></div>
      <div class="sep"></div>
      <div class="csec">Invite Token</div>
      <div class="cr"><div class="ck e"></div><div class="cn">token</div><div class="ct">TEXT UNIQUE</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">token_expires_at</div><div class="ct">TEXT</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">token_used_at</div><div class="ct">TEXT</div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck e"></div><div class="cn">applied_at</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">completed_at</div><div class="ct">TEXT</div></div>
    </div>
  </div>

  <!-- ═══════════════════════════
       interviews (880, 100)
       ═══════════════════════════ -->
  <div class="tbl c-intv" id="T-interviews" style="left:880px;top:100px">
    <div class="thead">
      <div class="stripe"></div>
      <div class="ticon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
        </svg>
      </div>
      <span class="tname">interviews</span>
      <span class="tbadge">Config per Job</span>
    </div>
    <div class="tbody">
      <div class="cr"><div class="ck pk">PK</div><div class="cn pk">id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck fk">FK</div><div class="cn fk">job_id</div><div class="ct">TEXT UNIQUE<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck fk">FK</div><div class="cn fk">company_id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck e"></div><div class="cn">title</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">default_timer_secs</div><div class="ct">INT DEFAULT 90</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">allow_retakes</div><div class="ct">INT DEFAULT 0</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">is_active</div><div class="ct">INT DEFAULT 1</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">created_at</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
    </div>
  </div>

  <!-- ═══════════════════════════
       interview_questions (880, 480)
       ═══════════════════════════ -->
  <div class="tbl c-iq" id="T-interview_questions" style="left:880px;top:480px">
    <div class="thead">
      <div class="stripe"></div>
      <div class="ticon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
      </div>
      <span class="tname">interview_questions</span>
      <span class="tbadge">Q + Answer</span>
    </div>
    <div class="tbody">
      <div class="cr"><div class="ck pk">PK</div><div class="cn pk">id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck fk">FK</div><div class="cn fk">interview_id</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck fk">FK</div><div class="cn fk">application_id</div><div class="ct">TEXT (nullable)</div></div>
      <div class="sep"></div>
      <div class="csec">Question</div>
      <div class="cr"><div class="ck e"></div><div class="cn">question_text</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">order_index</div><div class="ct">INT<span class="nn">NN</span></div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">timer_secs</div><div class="ct">INT DEFAULT 90</div></div>
      <div class="sep"></div>
      <div class="csec">Answer (filled by candidate)</div>
      <div class="cr"><div class="ck e"></div><div class="cn">answer_text</div><div class="ct">TEXT</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">score</div><div class="ct">REAL</div></div>
      <div class="cr"><div class="ck e"></div><div class="cn">answered_at</div><div class="ct">TEXT</div></div>
      <div class="sep"></div>
      <div class="cr"><div class="ck e"></div><div class="cn">created_at</div><div class="ct">TEXT<span class="nn">NN</span></div></div>
    </div>
  </div>

</div>
</div>

<script>
/* ── ZOOM / PAN ── */
let s = 0.70, tx = 40, ty = 20, drag = false, lx = 0, ly = 0;
const cvs = document.getElementById('cvs');
const wrap = document.getElementById('wrap');
const zv = document.getElementById('zv');
const tip = document.getElementById('tip');

function applyT() {
  cvs.style.transform = `translate(${tx}px,${ty}px) scale(${s})`;
  zv.textContent = Math.round(s * 100) + '%';
}
function zoom(d) { s = Math.min(2, Math.max(0.25, s + d)); applyT(); }
function resetView() { s = 0.70; tx = 40; ty = 20; applyT(); setTimeout(draw, 60); }

wrap.addEventListener('wheel', e => {
  e.preventDefault();
  s = Math.min(2, Math.max(0.25, s + (e.deltaY > 0 ? -0.08 : 0.08)));
  applyT();
}, { passive: false });

wrap.addEventListener('mousedown', e => {
  if (e.target.closest('.tbl')) return;
  drag = true; lx = e.clientX; ly = e.clientY;
});
window.addEventListener('mousemove', e => {
  if (!drag) return;
  tx += e.clientX - lx; ty += e.clientY - ly;
  lx = e.clientX; ly = e.clientY; applyT();
});
window.addEventListener('mouseup', () => { drag = false; });
applyT();

/* ── RELATIONS ── */
const RELS = [
  // companies → jobs (1:N)
  { f:'T-companies', t:'T-jobs', fs:'right', ts:'left',
    label:'1:N', col:'rgba(56,189,248,0.55)', note:'One company posts many jobs' },

  // companies → candidates (1:N)
  { f:'T-companies', t:'T-candidates', fs:'bottom', ts:'top',
    label:'1:N', col:'rgba(56,189,248,0.4)', note:'Candidates scoped to company (tenant isolation)' },

  // jobs → applications (1:N)
  { f:'T-jobs', t:'T-applications', fs:'bottom', ts:'top',
    label:'1:N', col:'rgba(74,222,128,0.55)', note:'One job receives many applications' },

  // candidates → applications (1:N)
  { f:'T-candidates', t:'T-applications', fs:'right', ts:'left',
    label:'1:N', col:'rgba(167,139,250,0.55)', note:'One candidate can apply to many jobs' },

  // jobs → interviews (1:1)
  { f:'T-jobs', t:'T-interviews', fs:'right', ts:'left',
    label:'1:1', col:'rgba(251,146,60,0.6)', note:'Each job has exactly one interview config (UNIQUE FK)' },

  // interviews → interview_questions (1:N)
  { f:'T-interviews', t:'T-interview_questions', fs:'bottom', ts:'top',
    label:'1:N', col:'rgba(251,146,60,0.5)', note:'One interview config has many questions' },

  // interviews → applications (1:N)
  { f:'T-interviews', t:'T-applications', fs:'bottom', ts:'right',
    label:'1:N', col:'rgba(251,146,60,0.4)', note:'One interview config receives many applications' },

  // applications → interview_questions (1:N)
  { f:'T-applications', t:'T-interview_questions', fs:'right', ts:'left',
    label:'1:N', col:'rgba(244,114,182,0.5)', note:'One application has many answered questions' },
];

function box(id) {
  const el = document.getElementById(id);
  return { x: parseInt(el.style.left), y: parseInt(el.style.top), w: el.offsetWidth, h: el.offsetHeight };
}

function pt(b, side) {
  if (side === 'top')    return { x: b.x + b.w / 2, y: b.y };
  if (side === 'bottom') return { x: b.x + b.w / 2, y: b.y + b.h };
  if (side === 'left')   return { x: b.x,            y: b.y + b.h / 2 };
  if (side === 'right')  return { x: b.x + b.w,      y: b.y + b.h / 2 };
}

function bez(p1, p2, fs, ts) {
  const cx = Math.min(140, Math.abs(p2.x - p1.x) * 0.5);
  const cy = Math.min(100, Math.abs(p2.y - p1.y) * 0.5);
  let c1x = p1.x, c1y = p1.y, c2x = p2.x, c2y = p2.y;
  if (fs === 'right')  c1x += cx; if (fs === 'left')  c1x -= cx;
  if (fs === 'bottom') c1y += cy; if (fs === 'top')   c1y -= cy;
  if (ts === 'left')   c2x -= cx; if (ts === 'right') c2x += cx;
  if (ts === 'top')    c2y -= cy; if (ts === 'bottom') c2y += cy;
  return `M${p1.x} ${p1.y} C${c1x} ${c1y},${c2x} ${c2y},${p2.x} ${p2.y}`;
}

function draw() {
  const svg = document.getElementById('rel');
  svg.innerHTML = `<defs><marker id="ah" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
    <path d="M0,0 L0,6 L8,3 z" fill="rgba(255,255,255,0.25)"/></marker></defs>`;

  RELS.forEach(r => {
    const fb = box(r.f), tb = box(r.t);
    const p1 = pt(fb, r.fs), p2 = pt(tb, r.ts);
    const d = bez(p1, p2, r.fs, r.ts);

    // hit area
    const hit = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    hit.setAttribute('d', d); hit.setAttribute('fill', 'none');
    hit.setAttribute('stroke', 'transparent'); hit.setAttribute('stroke-width', '14');
    hit.style.pointerEvents = 'stroke'; hit.style.cursor = 'default';
    svg.appendChild(hit);

    // line
    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    path.setAttribute('d', d); path.setAttribute('fill', 'none');
    path.setAttribute('stroke', r.col); path.setAttribute('stroke-width', '1.5');
    path.setAttribute('stroke-linecap', 'round'); path.setAttribute('marker-end', 'url(#ah)');
    svg.appendChild(path);

    // dots
    [p1, p2].forEach(p => {
      const c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      c.setAttribute('cx', p.x); c.setAttribute('cy', p.y); c.setAttribute('r', '4');
      c.setAttribute('fill', r.col); c.setAttribute('stroke', 'rgba(0,0,0,0.4)');
      c.setAttribute('stroke-width', '1');
      svg.appendChild(c);
    });

    // label
    const lbl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    lbl.setAttribute('x', (p1.x + p2.x) / 2);
    lbl.setAttribute('y', (p1.y + p2.y) / 2 - 7);
    lbl.setAttribute('text-anchor', 'middle');
    lbl.setAttribute('class', 'card-lbl');
    lbl.setAttribute('fill', r.col);
    lbl.textContent = r.label;
    svg.appendChild(lbl);

    // hover
    [hit, path].forEach(el => {
      el.style.pointerEvents = 'stroke';
      el.addEventListener('mouseenter', () => {
        path.setAttribute('stroke-width', '3');
        tip.textContent = `${r.f.replace('T-','')} → ${r.t.replace('T-','')}  (${r.label})  —  ${r.note}`;
        tip.classList.add('on');
      });
      el.addEventListener('mousemove', e => {
        tip.style.left = (e.clientX + 14) + 'px';
        tip.style.top = (e.clientY + 10) + 'px';
      });
      el.addEventListener('mouseleave', () => {
        path.setAttribute('stroke-width', '1.5');
        tip.classList.remove('on');
      });
    });
  });
}

window.addEventListener('load', () => {
  requestAnimationFrame(() => requestAnimationFrame(() => { draw(); setTimeout(draw, 400); }));
});
window.addEventListener('resize', draw);
</script>
</body>
</html>